import { 
  Entity, 
  Column, 
  PrimaryGeneratedColumn, 
  OneToOne, 
  BeforeInsert, 
  BeforeUpdate
} from 'typeorm'
import { Profile } from '.'
import { hashPassword } from 'shared/utils/hash-password'

@Entity({ name: 'users' })
export class User {
  @PrimaryGeneratedColumn()
  id: number

  @Column({ unique: true })
  email: string

  @Column()
  password: string

  @OneToOne(() => Profile, (profile) => profile.user)
  profile: Profile

  @BeforeInsert()
  @BeforeUpdate()
  hashPass() {
    this.password = hashPassword(this.password);
  }
}
